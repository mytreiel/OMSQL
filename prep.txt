#region IIS prep
Add-WindowsFeature NET-WCF-HTTP-Activation45,`
Web-Static-Content,`
Web-Default-Doc,`
Web-Dir-Browsing,`
Web-Http-Errors,`
Web-Http-Logging,`
Web-Request-Monitor,`
Web-Filtering,`
Web-Stat-Compression,`
Web-Mgmt-Console,`
Web-Metabase,`
Web-Asp-Net,`
Web-Windows-Auth -Restart -Source "D:\sxs\"

#endregion


#region SCOM Install
$SQLServerName = "SQL"
$OMServerName = "OM"
$MgmtGroup = "LAB2-SCOM"
$SQLInstance = $SQLServerName + "\SCOM"
#$SQLPort = "49763"
$DWSQLInstance = $SQLServerName + "\SCOMDW"
#$DWSQLPort = "49783"
$SRSInstance = "RPSVC\SRSS"
$OperationalDB = "OperationsManager"
$WarehouseDB = "OperationsManagerDW"
$domain = "COMPANY"
$ActionAccount = $domain + "\" + "gMSA_SCOM_MSAA$"
$DASAccount = $domain + "\" + "gMSA_SCOM_DAS$"
$ReadAccount = $domain + "\" + "gMSA_SCOM_DWR$"
$WriteAccount = $domain + "\" + "gMSA_SCOM_DWW$"
$WebsiteName = '"'+"Default Web Site"+'"'
$WebAuthMode = "Mixed"
$MgmtServer = $OMServerName + ".company.com"
$SetupLocation = "D:\Setup.exe"


$Arguments = @("/silent /install /components:OMServer,OMWebConsole,OMConsole",
"/ManagementGroupName:$MgmtGroup /SqlServerInstance:$SQLInstance",
"/SqlInstancePort:$SQLPort /DatabaseName:$OperationalDB",
"/DwSqlServerInstance:$DWSQLInstance /DwSqlInstancePort:$DWSQLPort",
"/DwDatabaseName:$WarehouseDB /ActionAccountUser:$ActionAccount",
"/DASAccountUser:$DASAccount /DataReaderUser:$ReadAccount",
"/DataWriterUser:$WriteAccount /ManagementServer:$MgmtServer",
"/WebSiteName:$WebsiteName /WebConsoleAuthorizationMode:$WebAuthMode",
"/EnableErrorReporting:Never /SendCEIPReports:0",
"/SendODRReports:0 /UseMicrosoftUpdate:0 /AcceptEndUserLicenseAgreement:1")


Start-Process $SetupLocation -ArgumentList $Arguments -Wait

#endregion
